<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>poisson_approval.profiles.ProfileCardinal &mdash; Poisson Approval 0.29.2 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Poisson Approval
          </a>
              <div class="version">
                0.29.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../readme.html">Poisson Approval</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks_article/index.html">Notebooks for our article</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../reference/index.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../authors.html">Credits</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../history.html">History</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Poisson Approval</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>poisson_approval.profiles.ProfileCardinal</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for poisson_approval.profiles.ProfileCardinal</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">fractions</span> <span class="kn">import</span> <span class="n">Fraction</span>
<span class="kn">from</span> <span class="nn">poisson_approval.constants.basic_constants</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">poisson_approval.constants.EquilibriumStatus</span> <span class="kn">import</span> <span class="n">EquilibriumStatus</span>
<span class="kn">from</span> <span class="nn">poisson_approval.profiles.Profile</span> <span class="kn">import</span> <span class="n">Profile</span>
<span class="kn">from</span> <span class="nn">poisson_approval.random_factories.RandTauVectorUniform</span> <span class="kn">import</span> <span class="n">RandTauVectorUniform</span>
<span class="kn">from</span> <span class="nn">poisson_approval.strategies.Strategy</span> <span class="kn">import</span> <span class="n">Strategy</span>
<span class="kn">from</span> <span class="nn">poisson_approval.strategies.StrategyThreshold</span> <span class="kn">import</span> <span class="n">StrategyThreshold</span>
<span class="kn">from</span> <span class="nn">poisson_approval.tau_vector.TauVector</span> <span class="kn">import</span> <span class="n">TauVector</span>
<span class="kn">from</span> <span class="nn">poisson_approval.utils.ComputationEngineNumeric</span> <span class="kn">import</span> <span class="n">ComputationEngineNumeric</span>
<span class="kn">from</span> <span class="nn">poisson_approval.utils.DictPrintingInOrderIgnoringZeros</span> <span class="kn">import</span> <span class="n">DictPrintingInOrderIgnoringZeros</span>
<span class="kn">from</span> <span class="nn">poisson_approval.utils.Util</span> <span class="kn">import</span> <span class="n">candidates_to_probabilities</span><span class="p">,</span> <span class="n">my_division</span><span class="p">,</span> <span class="n">array_to_d_candidate_value</span><span class="p">,</span> \
    <span class="n">one_over_t</span><span class="p">,</span> <span class="n">to_callable</span><span class="p">,</span> <span class="n">candidates_to_d_candidate_probability</span><span class="p">,</span> <span class="n">normalize_dict_to_0_1</span>
<span class="kn">from</span> <span class="nn">poisson_approval.utils.UtilBallots</span> <span class="kn">import</span> <span class="n">ballot_one</span><span class="p">,</span> <span class="n">ballot_one_two</span><span class="p">,</span> <span class="n">ballot_low_u</span><span class="p">,</span> <span class="n">ballot_high_u</span>
<span class="kn">from</span> <span class="nn">poisson_approval.utils.UtilCache</span> <span class="kn">import</span> <span class="n">cached_property</span><span class="p">,</span> <span class="n">property_deleting_cache</span>


<span class="c1"># noinspection PyUnresolvedReferences</span>
<div class="viewcode-block" id="ProfileCardinal"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal">[docs]</a><span class="k">class</span> <span class="nc">ProfileCardinal</span><span class="p">(</span><span class="n">Profile</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cardinal profile of preference (abstract class).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    ratio_sincere : Number</span>
<span class="sd">        The ratio of sincere voters, in the interval [0, 1]. This is used for :meth:`tau`.</span>
<span class="sd">    ratio_fanatic : Number</span>
<span class="sd">        The ratio of fanatic voters, in the interval [0, 1]. This is used for :meth:`tau`. The sum of `ratio_sincere`</span>
<span class="sd">        and `ratio_fanatic` must not exceed 1.</span>
<span class="sd">    voting_rule : str</span>
<span class="sd">        The voting rule. Possible values are ``APPROVAL``, ``PLURALITY`` and ``ANTI_PLURALITY``.</span>
<span class="sd">    symbolic : bool</span>
<span class="sd">        Whether the computations are symbolic or numeric.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ratio_sincere</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ratio_fanatic</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="n">APPROVAL</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">voting_rule</span><span class="o">=</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="n">symbolic</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio_sincere</span> <span class="o">=</span> <span class="n">ratio_sincere</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ratio_fanatic</span> <span class="o">=</span> <span class="n">ratio_fanatic</span>

    <span class="n">well_informed_voters</span> <span class="o">=</span> <span class="n">property_deleting_cache</span><span class="p">(</span><span class="s1">&#39;_well_informed_voters&#39;</span><span class="p">)</span>
    <span class="n">ratio_fanatic</span> <span class="o">=</span> <span class="n">property_deleting_cache</span><span class="p">(</span><span class="s1">&#39;_ratio_fanatic&#39;</span><span class="p">)</span>

    <span class="n">is_continuous</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="ProfileCardinal.have_ranking_with_utility_above_u"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.have_ranking_with_utility_above_u">[docs]</a>    <span class="k">def</span> <span class="nf">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Share of voters who have a given ranking and a utility for their middle candidate that is strictly above a</span>
<span class="sd">        given value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ranking : str</span>
<span class="sd">            A ranking, e.g. ``&#39;abc&#39;``.</span>
<span class="sd">        u : Number</span>
<span class="sd">            A utility between 0 and 1 (included).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Number</span>
<span class="sd">            The share of voters who have ranking `ranking` and a utility for their middle candidate strictly greater</span>
<span class="sd">            than `u`. This does **not** include the voters who have a weak order of preference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ProfileCardinal.have_ranking_with_utility_u"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.have_ranking_with_utility_u">[docs]</a>    <span class="k">def</span> <span class="nf">have_ranking_with_utility_u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Share of voters who have a given ranking and a utility for their middle candidate that is equal to a given</span>
<span class="sd">        value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ranking : str</span>
<span class="sd">            A ranking, e.g. ``&#39;abc&#39;``.</span>
<span class="sd">        u : Number</span>
<span class="sd">            A utility between 0 and 1 (included).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Number</span>
<span class="sd">            The share of voters who have ranking `ranking` and a utility for their middle candidate equal to `u`.</span>
<span class="sd">            This does **not** include the voters who have a weak order of preference. I.e. if `u=0` or `u=1`, then the</span>
<span class="sd">            share is 0.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

<div class="viewcode-block" id="ProfileCardinal.have_ranking_with_utility_below_u"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.have_ranking_with_utility_below_u">[docs]</a>    <span class="k">def</span> <span class="nf">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Share of voters who have a given ranking and a utility for their middle candidate that is strictly below a</span>
<span class="sd">        given value.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ranking : str</span>
<span class="sd">            A ranking, e.g. ``&#39;abc&#39;``.</span>
<span class="sd">        u : Number</span>
<span class="sd">            A utility between 0 and 1 (included).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Number</span>
<span class="sd">            The share of voters who have ranking `ranking` and a utility for their middle candidate strictly lower</span>
<span class="sd">            than `u`. This does **not** include the voters who have a weak order of preference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">d_ranking_share</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">DictPrintingInOrderIgnoringZeros</span><span class="p">({</span>
            <span class="n">ranking</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ranking</span> <span class="ow">in</span> <span class="n">RANKINGS</span>
        <span class="p">})</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">d_weak_order_share</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">standardized_version</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Profile : Standardized version of the profile (makes it unique, up to permutations of the candidates).&quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">d_candidate_welfare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DictPrintingInOrder : Welfare of each candidate.</span>
<span class="sd">            E.g. ``&#39;a&#39;: 0.7`` means that candidate ``&#39;a&#39;`` has a welfare (average utility) equal to 0.7 for the voters.</span>
<span class="sd">            Since utilities are in [0, 1], so is the welfare.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">d_candidate_relative_welfare</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;DictPrintingInOrder : Relative welfare of each candidate.</span>
<span class="sd">            This is similar to :attr:`d_candidate_welfare`, but renormalized so that the candidate with best welfare</span>
<span class="sd">            has 1 and the one with worst welfare has 0. In math:</span>
<span class="sd">            `relative_welfare = (welfare - min_welfare) / (max_welfare - min_welfare)`. In the case where all</span>
<span class="sd">            candidates have the same welfare, by convention, the relative welfare is 1 for all of them.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">normalize_dict_to_0_1</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_candidate_welfare</span><span class="p">)</span>

    <span class="c1"># Tau and strategy-related stuff</span>

<div class="viewcode-block" id="ProfileCardinal.tau"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.tau">[docs]</a>    <span class="k">def</span> <span class="nf">tau</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tau-vector associated to a strategy, with partial sincere and fanatic voting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strategy</span>
<span class="sd">            An argument accepted by :meth:`tau_strategic`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TauVector</span>
<span class="sd">            A share `ratio_sincere` of the voters vote sincerely (in the sense of :attr:`tau_sincere`),</span>
<span class="sd">            a share `ratio_fanatic` vote only for their top candidate (cf. :attr:`tau_fanatic`), and the rest of the</span>
<span class="sd">            voters vote strategically (in the sense of :meth:`tau_strategic`). In other words, this tau-vector</span>
<span class="sd">            is the barycenter of `tau_sincere`, `tau_fanatic` and `tau_strategic(strategy)`, with</span>
<span class="sd">            respective weights `ratio_sincere`, `ratio_fanatic` and `1 - ratio_sincere - ratio_fanatic`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tau_sincere</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_sincere</span>
        <span class="n">tau_fanatic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_fanatic</span>
        <span class="n">tau_strategic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_strategic</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
        <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">ballot</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">barycenter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">tau_strategic</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                        <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="n">tau_sincere</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span> <span class="n">tau_fanatic</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">]],</span>
                                        <span class="n">ratio_b</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio_sincere</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_fanatic</span><span class="p">])</span>
             <span class="k">for</span> <span class="n">ballot</span> <span class="ow">in</span> <span class="n">BALLOTS_WITHOUT_INVERSIONS</span><span class="p">}</span>
        <span class="k">return</span> <span class="n">TauVector</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">tau_sincere</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tau-vector associated to sincere voting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TauVector</span>
<span class="sd">            * In Approval, all voters approve of their top candidate, and voters approve of their middle candidate if</span>
<span class="sd">              and only if their utility for her is strictly greater than 0.5.</span>
<span class="sd">            * In Plurality, all voters vote for their top candidate.</span>
<span class="sd">            * In Anti-plurality, all voters vote against their bottom candidate (i.e. for the other two).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        In Plurality and Anti-plurality, sincere and fanatic voting are the same. They differ only in Approval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ballot_share_weak_voters_sincere</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ranking</span> <span class="ow">in</span> <span class="n">RANKINGS</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">APPROVAL</span><span class="p">:</span>
                <span class="n">share_vote_one_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="n">share_vote_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span> <span class="o">-</span> <span class="n">share_vote_one_two</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_one</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">share_vote_one</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_one_two</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">share_vote_one_two</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">PLURALITY</span><span class="p">:</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_one</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">ANTI_PLURALITY</span><span class="p">:</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_one_two</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">return</span> <span class="n">TauVector</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">tau_fanatic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tau-vector associated to fanatic voting.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TauVector</span>
<span class="sd">            * In Approval or Plurality, all voters approve of their top candidate only,</span>
<span class="sd">            * In Anti-plurality, all voters vote against their bottom candidate (i.e. for the other two).</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        In Plurality and Anti-plurality, sincere and fanatic voting are the same. They differ only in Approval.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ballot_share_weak_voters_fanatic</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">share</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="ow">in</span> <span class="p">{</span><span class="n">APPROVAL</span><span class="p">,</span> <span class="n">PLURALITY</span><span class="p">}:</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_one</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">share</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">ANTI_PLURALITY</span><span class="p">:</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_one_two</span><span class="p">(</span><span class="n">ranking</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">return</span> <span class="n">TauVector</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>

<div class="viewcode-block" id="ProfileCardinal.tau_strategic"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.tau_strategic">[docs]</a>    <span class="k">def</span> <span class="nf">tau_strategic</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tau-vector associated to a strategy (fully strategic voting).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strategy : StrategyThreshold</span>
<span class="sd">            A strategy that specifies at least all the rankings that are present in the profile. If some voters</span>
<span class="sd">            have a utility for their second candidate that is equal to the utility threshold of the strategy, then the</span>
<span class="sd">            ratio of optimistic voters must be specified.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TauVector</span>
<span class="sd">            Tau-vector associated to this profile and strategy `strategy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">strategy</span><span class="o">.</span><span class="n">voting_rule</span>
        <span class="n">t</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ballot_share_weak_voters_strategic</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">strategy</span><span class="o">.</span><span class="n">d_ranking_threshold</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">t</span><span class="p">[</span><span class="n">ballot_low_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="n">t</span><span class="p">[</span><span class="n">ballot_high_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="n">share_limit_voters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">share_limit_voters</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ratio_optimistic</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">d_ranking_ratio_optimistic</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_low_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">multiply_with_absorbing_zero</span><span class="p">(</span>
                    <span class="n">share_limit_voters</span><span class="p">,</span> <span class="n">ratio_optimistic</span><span class="p">)</span>
                <span class="n">t</span><span class="p">[</span><span class="n">ballot_high_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">)]</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">multiply_with_absorbing_zero</span><span class="p">(</span>
                    <span class="n">share_limit_voters</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio_optimistic</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">TauVector</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProfileCardinal.share_sincere"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.share_sincere">[docs]</a>    <span class="k">def</span> <span class="nf">share_sincere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Share of voters that happen to cast a sincere ballot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strategy</span>
<span class="sd">            An argument accepted by :meth:`share_sincere_among_strategic_voters`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Number</span>
<span class="sd">            The ratio of voters that happen to cast a sincere ballot. This includes all kinds of voters (sincere,</span>
<span class="sd">            fanatic or strategic).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">barycenter</span><span class="p">(</span>
            <span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">share_sincere_among_strategic_voters</span><span class="p">(</span><span class="n">strategy</span><span class="p">),</span>
            <span class="n">b</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">share_sincere_among_fanatic_voters</span><span class="p">],</span>
            <span class="n">ratio_b</span><span class="o">=</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio_sincere</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_fanatic</span><span class="p">]</span>
        <span class="p">)</span></div>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">share_sincere_among_fanatic_voters</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Number: Share of fanatic voters that happen to cast a sincere ballot.</span>

<span class="sd">        In Plurality or Anti-Plurality, this number is always 1 because fanatic voters are sincere by our definition.</span>

<span class="sd">        In Approval, this is the proportion of fanatic voters whose ballot happen to be sincere, i.e. whose utility</span>
<span class="sd">        for their second candidate is lower or equal to 0.5.</span>

<span class="sd">        Note that this share is relative to the share of fanatic voters: therefore, it is independent of</span>
<span class="sd">        `ratio_fanatic` and can be defined conventionally even if `ratio_fanatic` is 0, with the same</span>
<span class="sd">        computation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">APPROVAL</span><span class="p">:</span>
            <span class="n">share_sincere</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_weak_order_share</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="n">share_sincere</span> <span class="o">+=</span> <span class="nb">sum</span><span class="p">([</span>
                <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                    <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">ranking</span> <span class="ow">in</span> <span class="n">RANKINGS</span>
            <span class="p">])</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">share_sincere</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="ow">in</span> <span class="p">{</span><span class="n">PLURALITY</span><span class="p">,</span> <span class="n">ANTI_PLURALITY</span><span class="p">}:</span>
            <span class="k">return</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span>

<div class="viewcode-block" id="ProfileCardinal.share_sincere_among_strategic_voters"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.share_sincere_among_strategic_voters">[docs]</a>    <span class="k">def</span> <span class="nf">share_sincere_among_strategic_voters</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Share of strategic voters that happen to cast a sincere ballot.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strategy : StrategyThreshold</span>
<span class="sd">            A strategy that specifies at least all the rankings that are present in the profile. If some voters</span>
<span class="sd">            have a utility for their second candidate that is equal to the utility threshold of the strategy, then the</span>
<span class="sd">            ratio of optimistic voters must be specified.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Number</span>
<span class="sd">            The ratio of sincere voters among strategic voters. In particular, if all strategic voters happen to be</span>
<span class="sd">            sincere with the given strategy, then the ratio is 1, even if there are non-strategic voters (for example,</span>
<span class="sd">            in Approval, fanatic voters who have a utility &gt; 0.5 for their second candidate and are therefore not</span>
<span class="sd">            &quot;sincere&quot;, according to our definition).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">strategy</span><span class="o">.</span><span class="n">voting_rule</span>
        <span class="c1"># Weak orders: these voters are always &quot;sincere&quot;, even in Plurality or Anti-Plurality. For example, in</span>
        <span class="c1"># Plurality, a voter a~b&gt;c will either vote for a or b, and this is considered &quot;sincere&quot;.</span>
        <span class="n">share_sincere</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_weak_order_share</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
        <span class="c1"># Rankings</span>
        <span class="k">for</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">threshold</span> <span class="ow">in</span> <span class="n">strategy</span><span class="o">.</span><span class="n">d_ranking_threshold</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="c1"># Voters with a utility != strategy&#39;s threshold</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">APPROVAL</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                    <span class="n">share_sincere</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
                                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">share_sincere</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
                                      <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">PLURALITY</span><span class="p">:</span>
                <span class="n">share_sincere</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">ANTI_PLURALITY</span><span class="p">:</span>
                <span class="n">share_sincere</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span>
            <span class="c1"># Voters with a utility == strategy&#39;s threshold</span>
            <span class="n">share_limit_voters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">u</span><span class="o">=</span><span class="n">threshold</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">share_limit_voters</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ratio_optimistic</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">d_ranking_ratio_optimistic</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">APPROVAL</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">threshold</span> <span class="o">&lt;=</span> <span class="n">Fraction</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">):</span>
                        <span class="n">share_sincere</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">multiply_with_absorbing_zero</span><span class="p">(</span><span class="n">share_limit_voters</span><span class="p">,</span> <span class="n">ratio_optimistic</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">share_sincere</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">multiply_with_absorbing_zero</span><span class="p">(</span><span class="n">share_limit_voters</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio_optimistic</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">PLURALITY</span><span class="p">:</span>
                    <span class="n">share_sincere</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">multiply_with_absorbing_zero</span><span class="p">(</span><span class="n">share_limit_voters</span><span class="p">,</span> <span class="n">ratio_optimistic</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span> <span class="o">==</span> <span class="n">ANTI_PLURALITY</span><span class="p">:</span>
                    <span class="n">share_sincere</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">multiply_with_absorbing_zero</span><span class="p">(</span><span class="n">share_limit_voters</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">ratio_optimistic</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">simplify</span><span class="p">(</span><span class="n">share_sincere</span><span class="p">)</span></div>

<div class="viewcode-block" id="ProfileCardinal.is_equilibrium"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.is_equilibrium">[docs]</a>    <span class="k">def</span> <span class="nf">is_equilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Whether a strategy is an equilibrium.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        strategy : StrategyThreshold</span>
<span class="sd">            A strategy that specifies at least all the rankings that are present in the profile. If some voters</span>
<span class="sd">            have a utility for their second candidate that is equal to the utility threshold of the strategy, then the</span>
<span class="sd">            ratio of optimistic voters must be specified.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        EquilibriumStatus</span>
<span class="sd">            Whether `strategy` is an equilibrium in this profile. This is based on the assumption that:</span>

<span class="sd">            * A proportion `ratio_sincere` of voters cast their ballot sincerely (in the sense of</span>
<span class="sd">              :attr:`tau_sincere`),</span>
<span class="sd">            * A proportion `ratio_fanatic` of voters vote for their top candidate only,</span>
<span class="sd">            * And the rest of the voters use `strategy`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">this_tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
        <span class="n">d_ranking_best_response</span> <span class="o">=</span> <span class="n">this_tau</span><span class="o">.</span><span class="n">d_ranking_best_response</span>
        <span class="k">for</span> <span class="n">ranking</span><span class="p">,</span> <span class="n">share</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_ranking_share</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">share</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">actual_threshold</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">d_ranking_threshold</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span>
            <span class="n">br_threshold</span> <span class="o">=</span> <span class="n">d_ranking_best_response</span><span class="p">[</span><span class="n">ranking</span><span class="p">]</span><span class="o">.</span><span class="n">utility_threshold</span>
            <span class="n">test</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">look_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">actual_threshold</span><span class="p">),</span>
                                       <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_below_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">br_threshold</span><span class="p">),</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">)</span>
                    <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">ce</span><span class="o">.</span><span class="n">look_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">actual_threshold</span><span class="p">),</span>
                                           <span class="bp">self</span><span class="o">.</span><span class="n">have_ranking_with_utility_above_u</span><span class="p">(</span><span class="n">ranking</span><span class="p">,</span> <span class="n">br_threshold</span><span class="p">),</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">test</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">EquilibriumStatus</span><span class="o">.</span><span class="n">NOT_EQUILIBRIUM</span>
        <span class="k">return</span> <span class="n">EquilibriumStatus</span><span class="o">.</span><span class="n">EQUILIBRIUM</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">strategies_pure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">strategies_group</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span>

    <span class="k">def</span> <span class="nf">_initializer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initial condition for iterated voting or fictitious play.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        init : Strategy or TauVector or str</span>

<span class="sd">            * If it is a strategy, it must be an argument accepted by :meth:`tau`, i.e. by :meth:`tau_strategic`.</span>
<span class="sd">            * If it is a tau-vector, it is used directly.</span>
<span class="sd">            * If it is a string:</span>

<span class="sd">              * ``&#39;sincere&#39;`` or ``&#39;fanatic&#39;``: :attr:`tau_sincere` or :attr:`tau_fanatic` is respectively used.</span>
<span class="sd">              * ``&#39;random_tau&#39;``: use :class:`RandTauVectorUniform` to draw a tau-vector uniformly at random that</span>
<span class="sd">                is consistent with the voting rule.</span>
<span class="sd">              * ``&#39;random_tau_undominated&#39;``: use :meth:`random_tau_undominated` to draw a tau-vector where all voters</span>
<span class="sd">                cast an undominated ballot at random.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        strategy : Strategy, optional</span>
<span class="sd">            The initial strategy (or None).</span>
<span class="sd">        tau : TauVector</span>
<span class="sd">            The initial tau-vector.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Using fictitious play or iterated voting with symbolic=True is strongly discouraged. &#39;</span>
                          <span class="s1">&#39;Consider defining the profile with symbolic=False.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">Strategy</span><span class="p">):</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="n">init</span><span class="o">.</span><span class="n">deepcopy_with_attached_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">tau</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">init</span><span class="p">,</span> <span class="n">TauVector</span><span class="p">):</span>
                <span class="n">tau</span> <span class="o">=</span> <span class="n">init</span>
            <span class="k">elif</span> <span class="n">init</span> <span class="o">==</span> <span class="s1">&#39;sincere&#39;</span><span class="p">:</span>
                <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_sincere</span>
            <span class="k">elif</span> <span class="n">init</span> <span class="o">==</span> <span class="s1">&#39;fanatic&#39;</span><span class="p">:</span>
                <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tau_fanatic</span>
            <span class="k">elif</span> <span class="n">init</span> <span class="o">==</span> <span class="s1">&#39;random_tau&#39;</span><span class="p">:</span>
                <span class="n">tau</span> <span class="o">=</span> <span class="n">RandTauVectorUniform</span><span class="p">(</span><span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">)()</span>
            <span class="k">elif</span> <span class="n">init</span> <span class="o">==</span> <span class="s1">&#39;random_tau_undominated&#39;</span><span class="p">:</span>
                <span class="n">tau</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_tau_undominated</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span>
        <span class="k">return</span> <span class="n">strategy</span><span class="p">,</span> <span class="n">tau</span>

<div class="viewcode-block" id="ProfileCardinal.iterated_voting"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.iterated_voting">[docs]</a>    <span class="k">def</span> <span class="nf">iterated_voting</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">n_max_episodes</span><span class="p">,</span>
                        <span class="n">perception_update_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">ballot_update_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">winning_frequency_update_ratio</span><span class="o">=</span><span class="n">one_over_t</span><span class="p">,</span>
                        <span class="n">other_statistics_update_ratio</span><span class="o">=</span><span class="n">one_over_t</span><span class="p">,</span>
                        <span class="n">other_statistics_tau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">other_statistics_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Seek for convergence by iterated voting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        init : Strategy or TauVector or str</span>
<span class="sd">            The initialization.</span>

<span class="sd">            * If it is a strategy, it must be an argument accepted by :meth:`tau`, i.e. by :meth:`tau_strategic`.</span>
<span class="sd">            * If it is a tau-vector, it is used directly.</span>
<span class="sd">            * If it is a string:</span>

<span class="sd">              * ``&#39;sincere&#39;`` or ``&#39;fanatic&#39;``: :attr:`tau_sincere` or :attr:`tau_fanatic` is respectively used.</span>
<span class="sd">              * ``&#39;random_tau&#39;``: use :class:`RandTauVectorUniform` to draw a tau-vector uniformly at random that</span>
<span class="sd">                is consistent with the voting rule.</span>
<span class="sd">              * ``&#39;random_tau_undominated&#39;``: use :meth:`random_tau_undominated` to draw a tau-vector where all voters</span>
<span class="sd">                cast an undominated ballot at random.</span>

<span class="sd">        n_max_episodes : int</span>
<span class="sd">            Maximal number of iterations.</span>
<span class="sd">        perception_update_ratio : Number</span>
<span class="sd">            Number in [0, 1]. The coefficient when updating the perceived tau:</span>
<span class="sd">            `tau_perceived = (1 - perception_update_ratio) * tau_perceived + perception_update_ratio * tau_actual`.</span>
<span class="sd">        ballot_update_ratio : Number</span>
<span class="sd">            Number in [0, 1]. The ratio of voters who update their ballot:</span>
<span class="sd">            `tau_actual = (1 - ballot_update_ratio) * tau_actual + ballot_update_ratio * tau_response`.</span>
<span class="sd">        winning_frequency_update_ratio : callable or Number</span>
<span class="sd">            The coefficient when updating the winning frequency of each candidate:</span>
<span class="sd">            `d_candidate_winning_frequency[c] =</span>
<span class="sd">            (1 - winning_frequency_update_ratio(t)) * d_candidate_winning_frequency[c]</span>
<span class="sd">            + winning_frequency_update_ratio(t) * winning_probability[c]`.</span>
<span class="sd">            The default function is :func:`~utils.Util.one_over_t`, which leads to an arithmetic average.</span>
<span class="sd">            Note that this parameters has an influence only in case of non-convergence.</span>
<span class="sd">        other_statistics_update_ratio : callable or Number</span>
<span class="sd">            The coefficient when updating the other statistics (cf. below).</span>
<span class="sd">        other_statistics_tau : dict</span>
<span class="sd">            Key: name of the statistic (different from ``converges``, ``tau``, ``strategy``, ``tau_init``,</span>
<span class="sd">            ``n_episodes``, and ``d_candidate_winning_frequency``). Value: a function whose input is a tau-vector, and</span>
<span class="sd">            whose output is a number or a `numpy` array.</span>
<span class="sd">        other_statistics_strategy : dict</span>
<span class="sd">            Key: name of the statistic (different from ``converges``, ``tau``, ``strategy``, ``tau_init``,</span>
<span class="sd">            ``n_episodes``, ``d_candidate_winning_frequency`` and the names in ``other_statistics_tau``). Value: a</span>
<span class="sd">            function whose input is a strategy, and whose output is a number or a `numpy` array.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            If True, print all intermediate steps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            * Key ``converges``: bool. True if the process converges (i.e. cycle of length 1).</span>
<span class="sd">            * Key ``cycle_taus_perceived``: list of :class:`TauVector`. The limit cycle of perceived tau-vectors.</span>
<span class="sd">              `cycle_taus_perceived[t]` is a barycenter of `cycle_taus_perceived[t - 1]` with</span>
<span class="sd">              `cycle_taus_actual[t - 1]`, parametrized by `perception_update_ratio`.</span>
<span class="sd">            * Key ``cycle_strategies``: list of :class:`StrategyThreshold`. The limit cycle of strategies.</span>
<span class="sd">              `cycle_strategies[t]` is the best response to `cycle_taus_perceived[t]`.</span>
<span class="sd">            * Key ``cycle_taus_actual``: list of :class:`TauVector`. The limit cycle of actual tau-vectors.</span>
<span class="sd">              `cycle_taus_actual[t]` is a barycenter of `cycle_taus_actual[t - 1]` and the tau-vector resulting</span>
<span class="sd">              from `strategies[t]`, parametrized by `ballot_update_ratio`.</span>
<span class="sd">            * Key ``tau_init``: the tau-vector at initialization.</span>
<span class="sd">            * Key ``n_episodes``: the number of episodes until convergence. If the process did not converge, by</span>
<span class="sd">              convention, this value is `n_max_episodes`.</span>
<span class="sd">            * Key ``d_candidate_winning_frequency``: dict. Key: candidate. Value: winning frequency. If the process</span>
<span class="sd">              reached a limit or a periodical orbit, the winning frequencies are computed in the limit only. If the</span>
<span class="sd">              process did not converge, the frequency is computed on the whole history.</span>
<span class="sd">            * Others keys are those of ``other_statistics_tau`` and ``other_statistics_strategy``. Similarly to</span>
<span class="sd">              ``d_candidate_winning_frequency``, they give the long-run average of the corresponding statistics.</span>

<span class="sd">            The return values `cycle_taus_perceived`, `cycle_strategies` and `cycle_taus_actual` are lists of the same</span>
<span class="sd">            length. If the length is 1, the process converges to this limit. If it is greater than 1, the process</span>
<span class="sd">            reaches a periodical orbit. If it is 0, by convention, it means that the process does not converge and does</span>
<span class="sd">            not reach a periodical orbit.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Comparison between :meth:`iterated_voting` and :meth:`fictitious_play`:</span>

<span class="sd">        * :meth:`iterated_voting` can detect cycles (whereas :meth:`fictitious_play` only looks for a limit).</span>
<span class="sd">        * :meth:`fictitious_play` accepts update ratios that are functions of the time (whereas</span>
<span class="sd">          :meth:`iterated_voting` only accepts constants).</span>
<span class="sd">        * :meth:`fictitious_play` is faster and uses less memory, because it only looks for a limit and not for a cycle.</span>

<span class="sd">        In general, you should use :meth:`iterated_voting` only if you care about cycles, with the constraint</span>
<span class="sd">        that it implies having constant update ratios.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">winning_frequency_update_ratio</span> <span class="o">=</span> <span class="n">to_callable</span><span class="p">(</span><span class="n">winning_frequency_update_ratio</span><span class="p">)</span>
        <span class="n">other_statistics_update_ratio</span> <span class="o">=</span> <span class="n">to_callable</span><span class="p">(</span><span class="n">other_statistics_update_ratio</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other_statistics_tau</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_statistics_tau</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">other_statistics_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_statistics_strategy</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">strategy</span><span class="p">,</span> <span class="n">tau_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initializer</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="n">tau_actual</span> <span class="o">=</span> <span class="n">tau_init</span>
        <span class="n">tau_perceived</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;strategy: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strategy</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_actual: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_actual</span><span class="p">)</span>
        <span class="n">strategies</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">taus_actual</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">taus_perceived</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">array_candidate_winning_frequency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">d_name_statistic_tau_averaged</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="n">d_name_statistic_strategy_actual</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="n">d_name_statistic_strategy_averaged</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

        <span class="n">n_episodes</span> <span class="o">=</span> <span class="n">n_max_episodes</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_max_episodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tau_perceived</span> <span class="o">=</span> <span class="n">tau_actual</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tau_perceived</span> <span class="o">=</span> <span class="n">TauVector</span><span class="p">({</span>
                    <span class="n">ballot</span><span class="p">:</span> <span class="n">_my_round</span><span class="p">(</span><span class="n">ComputationEngineNumeric</span><span class="o">.</span><span class="n">barycenter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">tau_perceived</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">b</span><span class="o">=</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">ratio_b</span><span class="o">=</span><span class="n">perception_update_ratio</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">ballot</span> <span class="ow">in</span> <span class="n">BALLOTS_WITHOUT_INVERSIONS</span>
                <span class="p">},</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_responses_to_strategy</span><span class="p">(</span><span class="n">tau_perceived</span><span class="p">)</span>
            <span class="n">tau_full_response</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">tau</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tau_actual</span> <span class="o">=</span> <span class="n">tau_full_response</span>
                <span class="n">array_candidate_winning_frequency</span> <span class="o">=</span> <span class="n">candidates_to_probabilities</span><span class="p">(</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">winners</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">tau_actual</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
                    <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">wfur</span> <span class="o">=</span> <span class="n">winning_frequency_update_ratio</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">osur</span> <span class="o">=</span> <span class="n">other_statistics_update_ratio</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">tau_actual</span> <span class="o">=</span> <span class="n">TauVector</span><span class="p">({</span>
                    <span class="n">ballot</span><span class="p">:</span> <span class="n">_my_round</span><span class="p">(</span><span class="n">ComputationEngineNumeric</span><span class="o">.</span><span class="n">barycenter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">b</span><span class="o">=</span><span class="n">tau_full_response</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">ratio_b</span><span class="o">=</span><span class="n">ballot_update_ratio</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">ballot</span> <span class="ow">in</span> <span class="n">BALLOTS_WITHOUT_INVERSIONS</span>
                <span class="p">},</span> <span class="n">normalization_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>
                <span class="n">array_candidate_winning_frequency</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">wfur</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_candidate_winning_frequency</span>
                    <span class="o">+</span> <span class="n">wfur</span> <span class="o">*</span> <span class="n">candidates_to_probabilities</span><span class="p">(</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">winners</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">osur</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">osur</span> <span class="o">*</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">tau_actual</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">ballot_update_ratio</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">ballot_update_ratio</span> <span class="o">*</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">))</span>
                    <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">osur</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">osur</span> <span class="o">*</span> <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_perceived: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_perceived</span><span class="p">)</span>
                <span class="n">tau_perceived</span><span class="o">.</span><span class="n">print_magnitudes_order</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;strategy: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strategy</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_full_response: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_full_response</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_actual: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_actual</span><span class="p">)</span>
            <span class="c1"># If there is an exact cycle, it is useless to continue looping.</span>
            <span class="n">break_</span> <span class="o">=</span> <span class="p">(</span><span class="n">tau_actual</span><span class="p">,</span> <span class="n">tau_perceived</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">taus_actual</span><span class="p">,</span> <span class="n">taus_perceived</span><span class="p">)</span>

            <span class="n">taus_actual</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tau_actual</span><span class="p">)</span>
            <span class="n">taus_perceived</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tau_perceived</span><span class="p">)</span>
            <span class="n">strategies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">break_</span><span class="p">:</span>
                <span class="n">n_episodes</span> <span class="o">=</span> <span class="n">t</span>
                <span class="k">break</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus_actual</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">begin</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">begin</span>
                         <span class="k">for</span> <span class="n">begin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">end</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
                         <span class="k">if</span> <span class="n">taus_actual</span><span class="p">[</span><span class="n">begin</span><span class="p">]</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">taus_actual</span><span class="p">[</span><span class="n">end</span><span class="p">],</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">)</span>
                         <span class="ow">and</span> <span class="n">taus_perceived</span><span class="p">[</span><span class="n">begin</span><span class="p">]</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">taus_perceived</span><span class="p">[</span><span class="n">end</span><span class="p">],</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">))</span>
            <span class="n">cycle_taus_actual</span> <span class="o">=</span> <span class="n">taus_actual</span><span class="p">[</span><span class="n">begin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cycle_taus_perceived</span> <span class="o">=</span> <span class="n">taus_perceived</span><span class="p">[</span><span class="n">begin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cycle_strategies</span> <span class="o">=</span> <span class="n">strategies</span><span class="p">[</span><span class="n">begin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">d_candidate_winning_frequency</span> <span class="o">=</span> <span class="n">_d_candidate_winning_frequency</span><span class="p">(</span><span class="n">cycle_taus_actual</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_average_statistic</span><span class="p">(</span>
                    <span class="n">statistic_f</span><span class="p">,</span> <span class="n">cycle_taus_actual</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">_average_statistic</span><span class="p">(</span>
                    <span class="n">statistic_f</span><span class="p">,</span> <span class="n">cycle_strategies</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="n">cycle_taus_actual</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cycle_taus_perceived</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">cycle_strategies</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">d_candidate_winning_frequency</span> <span class="o">=</span> <span class="n">array_to_d_candidate_value</span><span class="p">(</span><span class="n">array_candidate_winning_frequency</span><span class="p">)</span>
        <span class="n">results</span><span class="o">=</span> <span class="p">{</span><span class="s1">&#39;converges&#39;</span><span class="p">:</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cycle_taus_actual</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>
                  <span class="s1">&#39;cycle_taus_perceived&#39;</span><span class="p">:</span> <span class="n">cycle_taus_perceived</span><span class="p">,</span>
                  <span class="s1">&#39;cycle_strategies&#39;</span><span class="p">:</span> <span class="n">cycle_strategies</span><span class="p">,</span>
                  <span class="s1">&#39;cycle_taus_actual&#39;</span><span class="p">:</span> <span class="n">cycle_taus_actual</span><span class="p">,</span>
                  <span class="s1">&#39;tau_init&#39;</span><span class="p">:</span> <span class="n">tau_init</span><span class="p">,</span>
                  <span class="s1">&#39;n_episodes&#39;</span><span class="p">:</span> <span class="n">n_episodes</span><span class="p">,</span>
                  <span class="s1">&#39;d_candidate_winning_frequency&#39;</span><span class="p">:</span> <span class="n">d_candidate_winning_frequency</span><span class="p">}</span>
        <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d_name_statistic_tau_averaged</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d_name_statistic_strategy_averaged</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="ProfileCardinal.fictitious_play"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.fictitious_play">[docs]</a>    <span class="k">def</span> <span class="nf">fictitious_play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">n_max_episodes</span><span class="p">,</span>
                        <span class="n">perception_update_ratio</span><span class="o">=</span><span class="n">one_over_t</span><span class="p">,</span>
                        <span class="n">ballot_update_ratio</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">winning_frequency_update_ratio</span><span class="o">=</span><span class="n">one_over_t</span><span class="p">,</span>
                        <span class="n">other_statistics_update_ratio</span><span class="o">=</span><span class="n">one_over_t</span><span class="p">,</span>
                        <span class="n">other_statistics_tau</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">other_statistics_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Seek for convergence by fictitious play.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        init : Strategy or TauVector or str</span>
<span class="sd">            The initialization.</span>

<span class="sd">            * If it is a strategy, it must be an argument accepted by :meth:`tau`, i.e. by :meth:`tau_strategic`.</span>
<span class="sd">            * If it is a tau-vector, it is used directly.</span>
<span class="sd">            * If it is a string:</span>

<span class="sd">              * ``&#39;sincere&#39;`` or ``&#39;fanatic&#39;``: :attr:`tau_sincere` or :attr:`tau_fanatic` is respectively used.</span>
<span class="sd">              * ``&#39;random_tau&#39;``: use :class:`RandTauVectorUniform` to draw a tau-vector uniformly at random that</span>
<span class="sd">                is consistent with the voting rule.</span>
<span class="sd">              * ``&#39;random_tau_undominated&#39;``: use :meth:`random_tau_undominated` to draw a tau-vector where all voters</span>
<span class="sd">                cast an undominated ballot at random.</span>

<span class="sd">        n_max_episodes : int</span>
<span class="sd">            Maximal number of iterations.</span>
<span class="sd">        perception_update_ratio : callable or Number</span>
<span class="sd">            The coefficient when updating the perceived tau:</span>
<span class="sd">            `tau_perceived = (1 - perception_update_ratio(t)) * tau_perceived + perception_update_ratio(t) *</span>
<span class="sd">            tau_actual`. For any `t` from 2 to `n_max_episodes` included, the update ratio must be in [0, 1]. The</span>
<span class="sd">            default function is :func:`~utils.Util.one_over_t`, which leads to an arithmetic average. However,</span>
<span class="sd">            the `recommended` function is :func:`~utils.Util.one_over_log_t_plus_one`, which accelerates the</span>
<span class="sd">            convergence. If `perception_update_ratio` is a Number, it is considered as a constant function.</span>
<span class="sd">        ballot_update_ratio : callable or Number</span>
<span class="sd">            The ratio of voters who update their ballot:</span>
<span class="sd">            `tau_actual = (1 - ballot_update_ratio(t)) * tau_actual + ballot_update_ratio(t) * tau_response`.</span>
<span class="sd">            For any `t` from 2 to `n_max_episodes` included, the update ratio must be in [0, 1]. The default function</span>
<span class="sd">            is the constant 1, which corresponds to a full update. If `ballot_update_ratio` is a Number, it is</span>
<span class="sd">            considered as a constant function.</span>
<span class="sd">        winning_frequency_update_ratio : callable or Number</span>
<span class="sd">            The coefficient when updating the winning frequency of each candidate:</span>
<span class="sd">            `d_candidate_winning_frequency[c] =</span>
<span class="sd">            (1 - winning_frequency_update_ratio(t)) * d_candidate_winning_frequency[c]</span>
<span class="sd">            + winning_frequency_update_ratio(t) * winning_probability[c]`.</span>
<span class="sd">            The default function is :func:`~utils.Util.one_over_t`, which leads to an arithmetic average.</span>
<span class="sd">            Note that this parameters has an influence only in case of non-convergence.</span>
<span class="sd">        other_statistics_update_ratio : callable or Number</span>
<span class="sd">            The coefficient when updating the other statistics (cf. below).</span>
<span class="sd">        other_statistics_tau : dict</span>
<span class="sd">            Key: name of the statistic (different from ``converges``, ``tau``, ``strategy``, ``tau_init``,</span>
<span class="sd">            ``n_episodes``, and ``d_candidate_winning_frequency``). Value: a function whose input is a tau-vector, and</span>
<span class="sd">            whose output is a number or a `numpy` array.</span>
<span class="sd">        other_statistics_strategy : dict</span>
<span class="sd">            Key: name of the statistic (different from ``converges``, ``tau``, ``strategy``, ``tau_init``,</span>
<span class="sd">            ``n_episodes``, ``d_candidate_winning_frequency`` and the names in ``other_statistics_tau``). Value: a</span>
<span class="sd">            function whose input is a strategy, and whose output is a number or a `numpy` array.</span>
<span class="sd">        verbose : bool</span>
<span class="sd">            If True, print all intermediate steps.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dict</span>
<span class="sd">            * Key ``converges``: bool. True if the process converges.</span>
<span class="sd">            * Key ``tau``: :class:`TauVector` or None. The limit tau-vector. If None, it means that the process did not</span>
<span class="sd">              converge.</span>
<span class="sd">            * Key ``strategy``: :class:`StrategyThreshold` or None. The limit strategy. If None, it means that the</span>
<span class="sd">              process did not converge.</span>
<span class="sd">            * Key ``tau_init``: the tau-vector at initialization.</span>
<span class="sd">            * Key ``n_episodes``: the number of episodes until convergence. If the process did not converge, by</span>
<span class="sd">              convention, this value is `n_max_episodes`.</span>
<span class="sd">            * Key ``d_candidate_winning_frequency``: dict. Key: candidate. Value: winning frequency. If the process</span>
<span class="sd">              reached a limit, the winning frequencies are computed in the limit only. If the process did not converge,</span>
<span class="sd">              the frequency is computed on the whole history.</span>
<span class="sd">            * Others keys are those of ``other_statistics_tau`` and ``other_statistics_strategy``. Similarly to</span>
<span class="sd">              ``d_candidate_winning_frequency``, they give the long-run average of the corresponding statistics.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Comparison between :meth:`iterated_voting` and :meth:`fictitious_play`:</span>

<span class="sd">        * :meth:`iterated_voting` can detect cycles (whereas :meth:`fictitious_play` only looks for a limit).</span>
<span class="sd">        * :meth:`fictitious_play` accepts update ratios that are functions of the time (whereas</span>
<span class="sd">          :meth:`iterated_voting` only accepts constants).</span>
<span class="sd">        * :meth:`fictitious_play` is faster and uses less memory, because it only looks for a limit and not for a cycle.</span>

<span class="sd">        In general, you should use :meth:`iterated_voting` only if you care about cycles, with the constraint</span>
<span class="sd">        that it implies having constant update ratios.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">perception_update_ratio</span> <span class="o">=</span> <span class="n">to_callable</span><span class="p">(</span><span class="n">perception_update_ratio</span><span class="p">)</span>
        <span class="n">ballot_update_ratio</span> <span class="o">=</span> <span class="n">to_callable</span><span class="p">(</span><span class="n">ballot_update_ratio</span><span class="p">)</span>
        <span class="n">winning_frequency_update_ratio</span> <span class="o">=</span> <span class="n">to_callable</span><span class="p">(</span><span class="n">winning_frequency_update_ratio</span><span class="p">)</span>
        <span class="n">other_statistics_update_ratio</span> <span class="o">=</span> <span class="n">to_callable</span><span class="p">(</span><span class="n">other_statistics_update_ratio</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">other_statistics_tau</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_statistics_tau</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">other_statistics_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_statistics_strategy</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">strategy</span><span class="p">,</span> <span class="n">tau_init</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_initializer</span><span class="p">(</span><span class="n">init</span><span class="p">)</span>
        <span class="n">tau_actual</span> <span class="o">=</span> <span class="n">tau_init</span>
        <span class="n">tau_perceived</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="mi">0</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;strategy: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strategy</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_actual: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_actual</span><span class="p">)</span>
        <span class="n">array_candidate_winning_frequency</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">d_name_statistic_tau_averaged</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="n">d_name_statistic_strategy_actual</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
        <span class="n">d_name_statistic_strategy_averaged</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_max_episodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tau_perceived</span> <span class="o">=</span> <span class="n">tau_actual</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tau_perceived</span> <span class="o">=</span> <span class="n">TauVector</span><span class="p">({</span>
                    <span class="n">ballot</span><span class="p">:</span> <span class="n">_my_round</span><span class="p">(</span><span class="n">ComputationEngineNumeric</span><span class="o">.</span><span class="n">barycenter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">tau_perceived</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">b</span><span class="o">=</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">ratio_b</span><span class="o">=</span><span class="n">perception_update_ratio</span><span class="p">(</span><span class="n">t</span><span class="p">)))</span>
                    <span class="k">for</span> <span class="n">ballot</span> <span class="ow">in</span> <span class="n">BALLOTS_WITHOUT_INVERSIONS</span>
                <span class="p">},</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>
            <span class="n">strategy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">best_responses_to_strategy</span><span class="p">(</span><span class="n">tau_perceived</span><span class="p">)</span>
            <span class="n">tau_full_response</span> <span class="o">=</span> <span class="n">strategy</span><span class="o">.</span><span class="n">tau</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">tau_actual</span> <span class="o">=</span> <span class="n">tau_full_response</span>
                <span class="n">array_candidate_winning_frequency</span> <span class="o">=</span> <span class="n">candidates_to_probabilities</span><span class="p">(</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">winners</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">tau_actual</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
                    <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bur</span> <span class="o">=</span> <span class="n">ballot_update_ratio</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">wfur</span> <span class="o">=</span> <span class="n">winning_frequency_update_ratio</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">osur</span> <span class="o">=</span> <span class="n">other_statistics_update_ratio</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
                <span class="n">tau_actual</span> <span class="o">=</span> <span class="n">TauVector</span><span class="p">({</span>
                    <span class="n">ballot</span><span class="p">:</span> <span class="n">_my_round</span><span class="p">(</span><span class="n">ComputationEngineNumeric</span><span class="o">.</span><span class="n">barycenter</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">b</span><span class="o">=</span><span class="n">tau_full_response</span><span class="o">.</span><span class="n">d_ballot_share</span><span class="p">[</span><span class="n">ballot</span><span class="p">],</span>
                                                                          <span class="n">ratio_b</span><span class="o">=</span><span class="n">bur</span><span class="p">))</span>
                    <span class="k">for</span> <span class="n">ballot</span> <span class="ow">in</span> <span class="n">BALLOTS_WITHOUT_INVERSIONS</span>
                <span class="p">},</span> <span class="n">normalization_warning</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">voting_rule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">voting_rule</span><span class="p">,</span> <span class="n">symbolic</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">symbolic</span><span class="p">)</span>
                <span class="n">array_candidate_winning_frequency</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">wfur</span><span class="p">)</span> <span class="o">*</span> <span class="n">array_candidate_winning_frequency</span>
                    <span class="o">+</span> <span class="n">wfur</span> <span class="o">*</span> <span class="n">candidates_to_probabilities</span><span class="p">(</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">winners</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">osur</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_name_statistic_tau_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">osur</span> <span class="o">*</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">tau_actual</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bur</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">bur</span> <span class="o">*</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">))</span>
                    <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">osur</span><span class="p">)</span> <span class="o">*</span> <span class="n">d_name_statistic_strategy_averaged</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">]</span>
                        <span class="o">+</span> <span class="n">osur</span> <span class="o">*</span> <span class="n">d_name_statistic_strategy_actual</span><span class="p">[</span><span class="n">statistic_name</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;t = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">t</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_perceived: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_perceived</span><span class="p">)</span>
                <span class="n">tau_perceived</span><span class="o">.</span><span class="n">print_magnitudes_order</span><span class="p">()</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;strategy: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">strategy</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_full_response: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_full_response</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;tau_actual: </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">tau_actual</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tau_full_response</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">tau_perceived</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tau_actual</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
                    <span class="n">tau_full_response</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">):</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;converges&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="n">tau_full_response</span><span class="p">,</span> <span class="s1">&#39;strategy&#39;</span><span class="p">:</span> <span class="n">strategy</span><span class="p">,</span>
                           <span class="s1">&#39;tau_init&#39;</span><span class="p">:</span> <span class="n">tau_init</span><span class="p">,</span> <span class="s1">&#39;n_episodes&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span>
                           <span class="s1">&#39;d_candidate_winning_frequency&#39;</span><span class="p">:</span> <span class="n">candidates_to_d_candidate_probability</span><span class="p">(</span><span class="n">tau_actual</span><span class="o">.</span><span class="n">winners</span><span class="p">)}</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="n">statistic_name</span><span class="p">:</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">tau_actual</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_tau</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">})</span>
                <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                    <span class="n">statistic_name</span><span class="p">:</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">strategy</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">statistic_name</span><span class="p">,</span> <span class="n">statistic_f</span> <span class="ow">in</span> <span class="n">other_statistics_strategy</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
                <span class="p">})</span>
                <span class="k">return</span> <span class="n">results</span>
        <span class="n">d_candidate_winning_frequency</span> <span class="o">=</span> <span class="n">array_to_d_candidate_value</span><span class="p">(</span><span class="n">array_candidate_winning_frequency</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;converges&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s1">&#39;tau&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;strategy&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                   <span class="s1">&#39;tau_init&#39;</span><span class="p">:</span> <span class="n">tau_init</span><span class="p">,</span> <span class="s1">&#39;n_episodes&#39;</span><span class="p">:</span> <span class="n">n_max_episodes</span><span class="p">,</span>
                   <span class="s1">&#39;d_candidate_winning_frequency&#39;</span><span class="p">:</span> <span class="n">d_candidate_winning_frequency</span><span class="p">}</span>
        <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d_name_statistic_tau_averaged</span><span class="p">)</span>
        <span class="n">results</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d_name_statistic_strategy_averaged</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="ProfileCardinal.order_and_label"><a class="viewcode-back" href="../../../reference/reference_profiles/reference_profile_cardinal.html#poisson_approval.ProfileCardinal.order_and_label">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">order_and_label</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span></div></div>


<span class="k">def</span> <span class="nf">_my_round</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Round to 0 or 1 if the number is close enough.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    x : Number</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Number</span>
<span class="sd">        Generally, return `x` (converted to float). If `x` is close enough to 0 or 1, then return 0 or 1 respectively.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>

<span class="sd">        &gt;&gt;&gt; _my_round(1E-10)</span>
<span class="sd">        0</span>
<span class="sd">        &gt;&gt;&gt; _my_round(0.999999999999999999)</span>
<span class="sd">        1</span>
<span class="sd">        &gt;&gt;&gt; _my_round(0.123456789)</span>
<span class="sd">        0.123456789</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">abs_tol</span><span class="o">=</span><span class="mf">1E-9</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_d_candidate_winning_frequency</span><span class="p">(</span><span class="n">taus</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Winning frequencies of the candidates.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    taus : list of :class:`TauVector`</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    DictPrintingInOrderIgnoringZeros</span>
<span class="sd">        Key: candidate. Value: its winning frequency. We count 1 victory each time the candidate is the only winner,</span>
<span class="sd">        and `1 / k` victory when there is a tie between `k` candidates. The number of victories is then divided</span>
<span class="sd">        by the number of tau-vector to get the winning frequency.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">        &gt;&gt;&gt; from fractions import Fraction</span>
<span class="sd">        &gt;&gt;&gt; tau_1 = TauVector({&#39;a&#39;: Fraction(2, 5), &#39;b&#39;: Fraction(2, 5), &#39;c&#39;: Fraction(1, 5)})</span>
<span class="sd">        &gt;&gt;&gt; tau_2 = TauVector({&#39;a&#39;: 0, &#39;b&#39;: 0, &#39;c&#39;: 1})</span>
<span class="sd">        &gt;&gt;&gt; _d_candidate_winning_frequency([tau_1, tau_2])</span>
<span class="sd">        {&#39;a&#39;: Fraction(1, 4), &#39;b&#39;: Fraction(1, 4), &#39;c&#39;: Fraction(1, 2)}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tau</span> <span class="ow">in</span> <span class="n">taus</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">+</span> <span class="n">candidates_to_probabilities</span><span class="p">(</span><span class="n">tau</span><span class="o">.</span><span class="n">winners</span><span class="p">)</span>
    <span class="n">n_taus</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus</span><span class="p">)</span>
    <span class="n">frequencies</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">my_division</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="n">n_taus</span><span class="p">)</span> <span class="k">for</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">counts</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">array_to_d_candidate_value</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_average_statistic</span><span class="p">(</span><span class="n">statistic_f</span><span class="p">,</span> <span class="n">taus_or_strategies</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Average of a statistic over several taus / strategies</span>

<span class="sd">    This is used for iterated voting in case of cycle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    statistic_f : callable</span>
<span class="sd">        Input: a tau-vector or a strategy. Output: a number or a `numpy` array.</span>
<span class="sd">    taus_or_strategies : list</span>
<span class="sd">        List of tau-vectors or strategies.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    number or numpy.ndarray</span>
<span class="sd">        The average of ``statistic_f`` over the cycle.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">        &gt;&gt;&gt; from fractions import Fraction</span>
<span class="sd">        &gt;&gt;&gt; tau_1 = TauVector({&#39;a&#39;: Fraction(2, 5), &#39;b&#39;: Fraction(2, 5), &#39;c&#39;: Fraction(1, 5)})</span>
<span class="sd">        &gt;&gt;&gt; tau_2 = TauVector({&#39;a&#39;: 0, &#39;b&#39;: 0, &#39;c&#39;: 1})</span>
<span class="sd">        &gt;&gt;&gt; def vote_for_a(tau):</span>
<span class="sd">        ...     return tau.a</span>
<span class="sd">        &gt;&gt;&gt; _average_statistic(vote_for_a, [tau_1, tau_2])</span>
<span class="sd">        Fraction(1, 5)</span>
<span class="sd">        &gt;&gt;&gt; def single_votes(tau):</span>
<span class="sd">        ...     return np.array([tau.a, tau.b, tau.c])</span>
<span class="sd">        &gt;&gt;&gt; _average_statistic(single_votes, [tau_1, tau_2])</span>
<span class="sd">        array([Fraction(1, 5), Fraction(1, 5), Fraction(3, 5)], dtype=object)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">taus_or_strategies</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="n">statistic_f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">taus_or_strategies</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2019, François Durand.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>